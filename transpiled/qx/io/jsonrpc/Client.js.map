{
  "version": 3,
  "sources": [
    "/home/runner/work/incubator.qx.io.jsonrpc/incubator.qx.io.jsonrpc/source/class/qx/io/jsonrpc/Client.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "statics",
    "__transports",
    "registerTransport",
    "uriRegExp",
    "transportClass",
    "io",
    "jsonrpc",
    "Client",
    "lang",
    "Type",
    "isRegExp",
    "Error",
    "Interface",
    "classImplements",
    "transport",
    "ITransport",
    "push",
    "events",
    "construct",
    "transportOrUri",
    "methodPrefix",
    "parser",
    "uri",
    "isString",
    "registeredTransport",
    "reverse",
    "match",
    "exception",
    "Transport",
    "INVALD_URI",
    "setTransport",
    "getTransport",
    "addListener",
    "evt",
    "handleIncoming",
    "getData",
    "setMethodPrefix",
    "protocol",
    "Parser",
    "setParser",
    "__requests",
    "properties",
    "check",
    "nullable",
    "members",
    "_prependMethodPrefix",
    "method",
    "getMethodPrefix",
    "startsWith",
    "_throwTransportException",
    "fireDataEvent",
    "forEach",
    "request",
    "handleTransportException",
    "send",
    "message",
    "Message",
    "Batch",
    "messages",
    "getBatch",
    "toArray",
    "requests",
    "filter",
    "Request",
    "id",
    "getId",
    "undefined",
    "INVALID_ID",
    "toObject",
    "toString",
    "sendRequest",
    "params",
    "getPromise",
    "sendNotification",
    "notification",
    "Notification",
    "sendBatch",
    "batch",
    "Assert",
    "assertInstance",
    "setMethod",
    "getMethod",
    "Promise",
    "all",
    "getPromises",
    "json",
    "getParser",
    "parse",
    "handleMessage",
    "e",
    "msg",
    "_cleanup",
    "dispose",
    "Result",
    "UNKNOWN_ID",
    "response",
    "DUPLICATE_ID",
    "resolve",
    "getResult",
    "error",
    "getError",
    "ex",
    "JsonRpc",
    "code",
    "reject"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* ************************************************************************\n\n   qooxdoo - the new era of web development\n\n   http://qooxdoo.org\n\n   Copyright:\n      2020 Christian Boulanger\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     See the LICENSE file in the project's top-level directory for details.\n\n   Authors:\n     * Christian Boulanger (cboulanger)\n\n************************************************************************ */\n\n/**\n * This class provides a JSON-RPC client object with auto-configuration of the\n * transport used (based on the URI passed).\n */\nqx.Class.define(\"qx.io.jsonrpc.Client\",\n{\n  extend : qx.core.Object,\n\n  statics: {\n\n    __transports: null,\n\n    /**\n     * Register a transport class for use with uris that match the given\n     * regular expression. The client will use the transport which first\n     * matches, starting with the last added transport\n     * @param {RegExp} uriRegExp\n     *    A regular expression which the URI must match\n     * @param {qx.io.jsonrpc.transport.ITransport}  transportClass\n     *    The qooxdoo class implementing the transport\n     */\n    registerTransport(uriRegExp, transportClass) {\n      if (qx.io.jsonrpc.Client.__transports === null) {\n        qx.io.jsonrpc.Client.__transports = [];\n      }\n      if (!qx.lang.Type.isRegExp(uriRegExp)) {\n        throw new Error(\"First argument must be a regular expression!\");\n      }\n      if (!qx.Interface.classImplements(transportClass, qx.io.jsonrpc.transport.ITransport)) {\n        throw new Error(\"Transport class must implement qx.io.jsonrpc.transport.ITransport\");\n      }\n      qx.io.jsonrpc.Client.__transports.push({ uriRegExp, transport: transportClass});\n    }\n\n  },\n\n  events : {\n    /**\n     * Event fired when a request results in an error. Event data is an instance of\n     * {@link qx.io.jsonrpc.exception.Transport}, {@link qx.io.jsonrpc.exception.JsonRpc},\n     * or {@link qx.io.jsonrpc.exception.Cancel}.\n     * Event fired when a message is received from the endpoint. Event data\n     * is an UTF-8 encoded string\n     */\n    \"error\" : \"qx.event.type.Data\",\n\n    /**\n     * Event fired when a peer-originated JSON-RPC message has been\n     * received from the peer endpoint. Event data is an instance of {@link\n     * qx.io.jsonrpc.message.Batch}, {@link qx.io.jsonrpc.message.Request}\n     * or {@link qx.io.jsonrpc.message.Notification}.\n     */\n    \"peerRequest\" : \"qx.event.type.Data\"\n  },\n\n  /**\n   * @param {qx.io.jsonrpc.transport.ITransport|String} transportOrUri\n   *    Transport object, which must implement {@link qx.io.jsonrpc.transport.ITransport}\n   *    or a string URI, which will trigger auto-detection of transport, as long as an\n   *    appropriate transport has been registered with the static `registerTransport()` function.\n   * @param {String?} methodPrefix\n   *    Optional service name which will be prepended to the method\n   * @param {qx.io.jsonrpc.protocol.Parser?} parser\n   *    Optional parser object, which needs to be an instance of a subclass of {@link qx.io.jsonrpc.protocol.Parser}\n   */\n  construct : function(transportOrUri, methodPrefix, parser) {\n    this.base(arguments);\n    if (qx.io.jsonrpc.Client.__transports === null) {\n      qx.io.jsonrpc.Client.__transports = [];\n    }\n    let transport, uri;\n    if (qx.lang.Type.isString(transportOrUri)) {\n      uri = transportOrUri;\n      for (let registeredTransport of qx.io.jsonrpc.Client.__transports.reverse()) {\n        if (uri.match(registeredTransport.uriRegExp)) {\n          transport = new registeredTransport.transport(uri);\n        }\n      }\n      if (!transport) {\n        throw new qx.io.jsonrpc.exception.Transport(\n          `No matching transport for URI '${transportOrUri}'`,\n          qx.io.jsonrpc.exception.Transport.INVALD_URI\n        );\n      }\n    } else {\n      transport = transportOrUri;\n    }\n    this.setTransport(transport);\n\n    // listen for incoming messages\n    this.getTransport().addListener(\"message\", evt => this.handleIncoming(evt.getData()));\n\n    if (!methodPrefix) {\n      methodPrefix = \"\";\n    }\n    this.setMethodPrefix(methodPrefix);\n\n    if (!parser) {\n      parser = new qx.io.jsonrpc.protocol.Parser();\n    }\n    this.setParser(parser);\n\n    this.__requests = [];\n  },\n\n\n  properties :\n  {\n\n    /**\n     * An optional string which is prepended to the method name.\n     */\n    methodPrefix :\n    {\n      check : \"String\",\n      nullable : true\n    },\n\n    /**\n     * The transport object\n     */\n    transport:\n    {\n      check : \"qx.io.jsonrpc.transport.ITransport\"\n    },\n\n    /**\n     * The parser object, which must be a subclass of {@link qx.io.jsonrpc.protocol.Parser}\n      */\n    parser: {\n      check : \"qx.io.jsonrpc.protocol.Parser\"\n    }\n  },\n\n  members :\n  {\n\n    /**\n     * A cache of the requests which have been sent out and are still pending\n     */\n    __requests : null,\n\n    /**\n     * If a service name has been configured, prepend it to the method name\n     * @param {String} method\n     * @return {String}\n     * @private\n     */\n    _prependMethodPrefix(method) {\n      let methodPrefix = this.getMethodPrefix();\n      if (methodPrefix && !method.startsWith(methodPrefix + \".\")) {\n        return `${methodPrefix}.${method}`;\n      }\n      return method;\n    },\n\n    /**\n     * Fires \"error\" event and throws the error after informing pending requests\n     * about the error.\n     * @param exception\n     * @private\n     */\n    _throwTransportException(exception) {\n      this.fireDataEvent(\"error\", exception);\n      this.__requests.forEach(request => request.handleTransportException(exception));\n      throw exception;\n    },\n\n    /**\n     * Send the given JSON-RPC message object using the configured transport\n     *\n     * @param {qx.io.jsonrpc.protocol.Message|qx.io.jsonrpc.protocol.Batch} message\n     * @return {qx.Promise} Promise that resolves (with no data)\n     * when the message has been successfully sent out, and rejects\n     * when there is an error or a cancellation up to that point.\n     */\n    async send(message) {\n      if (!(message instanceof qx.io.jsonrpc.protocol.Message || message instanceof qx.io.jsonrpc.protocol.Batch)) {\n        throw new Error(\"Argument must be instanceof qx.io.jsonrpc.protocol.Message or qx.io.jsonrpc.protocol.Batch\");\n      }\n\n      // filter by type\n      let messages = message instanceof qx.io.jsonrpc.protocol.Batch ? message.getBatch().toArray() : [message];\n      let requests = messages.filter(message => message instanceof qx.io.jsonrpc.protocol.Request);\n\n      // store requests\n      requests.forEach(request => {\n        let id = request.getId();\n        if (this.__requests[id] !== undefined) {\n          throw new qx.io.jsonrpc.exception.Transport(`Request ID ${id} is already in use`, qx.io.jsonrpc.exception.Transport.INVALID_ID, {request: message.toObject()});\n        }\n        this.__requests[id] = request;\n      });\n\n      // send it async, using transport-specific implementation\n      return this.getTransport().send(message.toString());\n    },\n\n    /**\n     * Sends a single JSON-RPC request. If a service name has been configured,\n     * it is prepended to the method name with a dot.\n     * @param {String} method\n     * @param {Array|Object?} params\n     * @return {qx.Promise} Promise that resolves with the result to that request,\n     * and rejects with an exception in the {@link qx.io.jsonrpc.exception} namespace.\n     */\n    async sendRequest(method, params) {\n      const request = new qx.io.jsonrpc.protocol.Request(this._prependMethodPrefix(method), params);\n      this.send(request);\n      return await request.getPromise();\n    },\n\n    /**\n     * Sends a single JSON-RPC notification. If a service name has been configured,\n     * it is prepended to the method name with a dot.\n     * @param {String} method\n     * @param {Array|Object?} params\n     */\n    sendNotification(method, params) {\n      const notification = new qx.io.jsonrpc.protocol.Notification(this._prependMethodPrefix(method), params);\n      this.send(notification);\n    },\n\n    /**\n     * Send the given message batch. If a service name has been configured,\n     * it is prepended to the method name in each message with a dot.\n     * @param {qx.io.jsonrpc.protocol.Batch} batch\n     * @return {qx.Promise} Promise that resolves with an array of the responses\n     * to all requests in the batch, or rejects with any error that occurs.\n     */\n    async sendBatch(batch) {\n      qx.core.Assert.assertInstance(batch, qx.io.jsonrpc.protocol.Batch);\n      if (this.getMethodPrefix()) {\n        batch.getBatch().forEach(message => message.setMethod(this._prependMethodPrefix(message.getMethod())));\n      }\n      this.send(batch);\n      return await qx.Promise.all(batch.getPromises());\n    },\n\n    /**\n     * Receives and handles an incoming JSON-RPC compliant message data\n     * @param {String} json JSON data\n     */\n    handleIncoming(json) {\n      let message;\n      try {\n        message = this.getParser().parse(json);\n        // act on each message\n        this.handleMessage(message);\n      } catch (e) {\n        this._throwTransportException(e);\n      } finally {\n        // cleanup\n        if (message instanceof qx.io.jsonrpc.protocol.Batch) {\n          message.getBatch().forEach(msg => this._cleanup(msg));\n        } else if (message instanceof qx.io.jsonrpc.protocol.Message) {\n          this._cleanup(message);\n        }\n      }\n    },\n\n    /**\n     * Clean up after a message has been received\n     * @param {qx.io.jsonrpc.protocol.Message} message\n     * @private\n     */\n    _cleanup(message) {\n      if (message instanceof qx.io.jsonrpc.protocol.Request) {\n        let id = message.getId();\n        delete this.__requests[id];\n      }\n      message.dispose();\n    },\n\n    /**\n     * Handle an incoming message or batch of messages\n     * @param {qx.io.jsonrpc.protocol.Message|qx.io.jsonrpc.protocol.Batch} message Message or Batch\n     */\n    handleMessage(message) {\n      // handle batches\n      if (message instanceof qx.io.jsonrpc.protocol.Batch) {\n        message.getBatch().forEach(msg => this.handleMessage(msg));\n        return;\n      }\n      // handle individual message\n      this.assertInstance(message, qx.io.jsonrpc.protocol.Message);\n      let request, id;\n      if (message instanceof qx.io.jsonrpc.protocol.Result || message instanceof qx.io.jsonrpc.protocol.Error) {\n        // handle results and errors, which are responses to sent requests\n        id = message.getId();\n        request = this.__requests[id];\n        if (request === undefined) {\n          throw new qx.io.jsonrpc.exception.Transport(\n            `Invalid jsonrpc response data: Unknown id ${id}.`,\n            qx.io.jsonrpc.exception.Transport.UNKNOWN_ID,\n            {response: message.toObject()});\n        }\n        if (request.response) {\n          throw new qx.io.jsonrpc.exception.Transport(\n              `Invalid jsonrpc response data: multiple responses with same id ${id}.`,\n              qx.io.jsonrpc.exception.Transport.DUPLICATE_ID,\n              {request: request.toObject(), response: message.toObject()});\n        }\n        request.response = message.toObject();\n      }\n      // handle the different message types\n      if (message instanceof qx.io.jsonrpc.protocol.Result) {\n        // resolve the individual promise\n        request.getPromise().resolve(message.getResult());\n      } else if (message instanceof qx.io.jsonrpc.protocol.Error) {\n        let error = message.getError();\n        let ex = new qx.io.jsonrpc.exception.JsonRpc(\n          error.message,\n          error.code,\n          {\n            request: request.toObject(),\n            response: message.toObject()\n          });\n        // inform listeners\n        this.fireDataEvent(\"error\", ex);\n        // reject the individual promise\n        request.getPromise().reject(ex);\n      } else if (message instanceof qx.io.jsonrpc.protocol.Request || message instanceof qx.io.jsonrpc.protocol.Notification ) {\n        // handle peer-originated requests and notifications\n        this.fireDataEvent(\"peerRequest\", message)\n      } else {\n        throw new Error(\"Unhandled message:\" + message.toString());\n      }\n    }\n  }\n});\n"
  ]
}