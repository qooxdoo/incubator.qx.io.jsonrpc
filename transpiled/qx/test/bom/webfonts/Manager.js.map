{
  "version": 3,
  "sources": [
    "/home/runner/work/incubator.qx.io.jsonrpc/incubator.qx.io.jsonrpc/node_modules/@qooxdoo/compiler/node_modules/@qooxdoo/framework/source/class/qx/test/bom/webfonts/Manager.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "test",
    "bom",
    "webfonts",
    "Abstract",
    "include",
    "dev",
    "unit",
    "MRequirements",
    "members",
    "__fontDefinitions",
    "finelinerScript",
    "family",
    "source",
    "util",
    "ResourceManager",
    "getInstance",
    "toUri",
    "fontawesome",
    "invalid",
    "__findRule",
    "familyName",
    "reg",
    "RegExp",
    "helper",
    "cssText",
    "replace",
    "exec",
    "i",
    "l",
    "document",
    "styleSheets",
    "length",
    "sheet",
    "cssRules",
    "j",
    "m",
    "setUp",
    "require",
    "__nodesBefore",
    "body",
    "childNodes",
    "__sheetsBefore",
    "__manager",
    "Manager",
    "tearDown",
    "dispose",
    "VALIDATION_TIMEOUT",
    "$$instance",
    "assertEquals",
    "font",
    "WebFont",
    "set",
    "size",
    "sources",
    "event",
    "Timer",
    "once",
    "resume",
    "foundRule",
    "assertTrue",
    "wait",
    "that",
    "window",
    "setTimeout",
    "assertFalse",
    "comparisonString",
    "version",
    "n"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* ************************************************************************\n\n   qooxdoo - the new era of web development\n\n   http://qooxdoo.org\n\n   Copyright:\n     2007-2011 1&1 Internet AG, Germany, http://www.1und1.de\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     See the LICENSE file in the project's top-level directory for details.\n\n************************************************************************ */\n\n/* ************************************************************************\n************************************************************************ */\n/**\n *\n * @asset(qx/test/webfonts/*)\n */\n\nqx.Class.define(\"qx.test.bom.webfonts.Manager\", {\n\n  extend : qx.test.bom.webfonts.Abstract,\n\n  include : [qx.dev.unit.MRequirements],\n\n  members :\n  {\n    __fontDefinitions :\n    {\n      finelinerScript :\n      {\n        family : \"FinelinerScriptRegular\",\n        source: [ qx.util.ResourceManager.getInstance().toUri(\"qx/test/webfonts/fineliner_script-webfont.woff\"),\n                  qx.util.ResourceManager.getInstance().toUri(\"qx/test/webfonts/fineliner_script-webfont.ttf\"),\n                  qx.util.ResourceManager.getInstance().toUri(\"qx/test/webfonts/fineliner_script-webfont.eot\") ]\n      },\n      fontawesome :\n      {\n        family : \"FontAwesome\",\n        source: [ qx.util.ResourceManager.getInstance().toUri(\"qx/test/webfonts/fontawesome-webfont.woff\"),\n                  qx.util.ResourceManager.getInstance().toUri(\"qx/test/webfonts/fontawesome-webfont.ttf\"),\n                  qx.util.ResourceManager.getInstance().toUri(\"qx/test/webfonts/fontawesome-webfont.eot\") ]\n      },\n      invalid :\n      {\n        family : \"MonkeypooBold\",\n        source: [ \"404.woff\",\n                  \"404.ttf\",\n                  \"404.eot\" ]\n      }\n    },\n\n    __findRule : function(familyName)\n    {\n      var reg = new RegExp(\"@font-face.*?\" + familyName, \"m\");\n      var helper = function(cssText) {\n        cssText = cssText.replace(/\\n/g, \"\").replace(/\\r/g, \"\");\n        if (reg.exec(cssText)) {\n          return true;\n        }\n        return false;\n      };\n\n\n      for (var i=0,l=document.styleSheets.length; i<l; i++) {\n        var sheet = document.styleSheets[i];\n        if (sheet.cssText) {\n          if (helper(sheet.cssText)) {\n            return true;\n          }\n        }\n        else if (sheet.cssRules) {\n          for (var j=0,m=sheet.cssRules.length; j<m; j++) {\n            if (helper(sheet.cssRules[j].cssText)) {\n              return true;\n            }\n          }\n        }\n      }\n      return false;\n    },\n\n    setUp : function()\n    {\n      this.require([\"webFontSupport\"]);\n      this.__nodesBefore = document.body.childNodes.length;\n      this.__sheetsBefore = document.styleSheets.length;\n      this.__manager = qx.bom.webfonts.Manager.getInstance();\n    },\n\n    tearDown : function()\n    {\n      this.__manager.dispose();\n      qx.bom.webfonts.Manager.VALIDATION_TIMEOUT = 5000;\n      delete qx.bom.webfonts.Manager.$$instance;\n      this.__manager = null;\n      this.assertEquals(this.__nodesBefore, document.body.childNodes.length, \"Manager did not remove all nodes!\");\n      this.assertEquals(this.__sheetsBefore, document.styleSheets.length, \"Manager did not remove stylesheet!\");\n    },\n\n    \"test: create rule for valid font\" : function()\n    {\n      var font = new qx.bom.webfonts.WebFont();\n      font.set({\n        size: 18,\n        family: [\"monospace\"],\n        sources: [this.__fontDefinitions.finelinerScript]\n      });\n\n      qx.event.Timer.once(function() {\n        this.resume(function() {\n          var foundRule = this.__findRule(this.__fontDefinitions.finelinerScript.family);\n          this.assertTrue(foundRule, \"@font-face rule not found in document styles!\");\n        }, this);\n      }, this, 2000);\n\n      this.wait(3000);\n    },\n\n    \"test: do not create rule for invalid font\" : function()\n    {\n      qx.bom.webfonts.Manager.VALIDATION_TIMEOUT = 100;\n      var font = new qx.bom.webfonts.WebFont();\n      font.set({\n        family: [\"monospace\"],\n        sources: [this.__fontDefinitions.invalid]\n      });\n\n      var that = this;\n      window.setTimeout(function() {\n        that.resume(function() {\n          var foundRule = this.__findRule(this.__fontDefinitions.invalid.family);\n          this.assertFalse(foundRule, \"@font-face rule for invalid font found in document styles!\");\n        }, that);\n\n      }, 2000);\n\n      this.wait(3000);\n    },\n\n    \"test: load webfont whith custom comparisonString\" : function()\n    {\n      qx.bom.webfonts.Manager.VALIDATION_TIMEOUT = 100;\n      var font = new qx.bom.webfonts.WebFont();\n      font.set({\n        family: [\"fontawesome\"],\n        comparisonString : \"\\uf206\\uf1e3\\uf118\\uf2a7\",\n        sources: [this.__fontDefinitions.fontawesome]\n      });\n\n      var that = this;\n      window.setTimeout(function() {\n        that.resume(function() {\n          var foundRule = this.__findRule(this.__fontDefinitions.fontawesome.family);\n          this.assertTrue(foundRule, \"@font-face rule for custom comparisonString font not found in document styles!\");\n        }, that);\n\n      }, 2000);\n\n      this.wait(3000);\n    },\n\n    \"test: load webfont with custom version\" : function()\n    {\n      var font = new qx.bom.webfonts.WebFont();\n      font.set({\n        family: [\"monospace\"],\n        version : \"1.0\",\n        sources: [this.__fontDefinitions.finelinerScript]\n      });\n\n      qx.event.Timer.once(function() {\n        this.resume(function() {\n          var foundRule = false;\n          // it is browser dependent which type of font is loaded (woff, eot or ttf) so we have to\n          // check all given types, stopping the loop if the font rule was found\n          for(var n=0; n<this.__fontDefinitions.finelinerScript.source.length && foundRule === false; n++) {\n            foundRule = this.__findRule(this.__fontDefinitions.finelinerScript.source[n] + \"\\\\?1\\\\.0\");\n          }\n          this.assertTrue(foundRule, \"@font-face rule for custom version not found in document styles!\");\n        }, this);\n\n      }, this, 2000);\n\n      this.wait(3000);\n    }\n  }\n});\n"
  ]
}